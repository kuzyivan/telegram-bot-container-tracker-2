<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Коммерческое предложение</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #525659; }
        .page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 20px auto;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            position: relative;
        }
        @media print {
            body { background: white; }
            .page { margin: 0; box-shadow: none; width: 100%; height: auto; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

    <!-- Кнопка печати (скрывается при печати) -->
    <div class="fixed top-4 right-4 no-print flex gap-2">
        <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 font-bold">
            Скачать PDF / Печать
        </button>
        <button onclick="window.close()" class="bg-gray-600 text-white px-4 py-2 rounded shadow hover:bg-gray-700">
            Закрыть
        </button>
    </div>

    <div class="page">
        <!-- Шапка -->
        <div class="flex justify-between items-start border-b-2 border-black pb-6 mb-8">
            <div class="flex items-center gap-3">
                <div class="bg-black text-white p-2 rounded">
                    <!-- Логотип (SVG) -->
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight uppercase">Logistrail</h1>
                    <p class="text-xs text-gray-500 font-medium">Транспортно-экспедиционная компания</p>
                </div>
            </div>
            <div class="text-right text-sm">
                <p class="font-bold">Коммерческое предложение</p>
                <p class="text-gray-500">Дата: {{ date }}</p>
            </div>
        </div>

        <!-- Вступление -->
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-2">Предложение по перевозке</h2>
            <p class="text-gray-600 text-sm leading-relaxed">
                Мы рады предложить вам следующие ставки на организацию железнодорожных перевозок.<br>
                Ставки указаны в рублях, включают НДС 22% и станционные расходы.
            </p>
        </div>

        <!-- Таблица -->
        <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
            <table class="w-full text-left text-sm">
                <thead class="bg-gray-50 border-b border-gray-200 uppercase text-xs font-bold text-gray-500">
                    <tr>
                        <th class="px-6 py-4">Направление</th>
                        <th class="px-6 py-4 text-center">Тип контейнера</th>
                        <th class="px-6 py-4 text-right">Ставка (с НДС)</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for row in rows %}
                    <tr class="group">
                        <td class="px-6 py-4">
                            <div class="font-bold text-black">{{ row.title }}</div>
                            <div class="text-xs text-gray-400 mt-1 font-mono uppercase">{{ row.station_from }} ➝ {{ row.station_to }}</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="inline-block px-2 py-1 bg-gray-100 rounded text-xs font-bold text-gray-700 border border-gray-200">
                                {{ row.type.replace('_', ' ') }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <span class="text-lg font-bold text-black whitespace-nowrap">
                                {{ "{:,.0f}".format(row.price).replace(',', ' ') }} ₽
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Условия (Футер) -->
        <div class="mt-auto pt-8 border-t border-gray-200 text-xs text-gray-500">
            <div class="grid grid-cols-2 gap-8">
                <div>
                    <h3 class="font-bold text-black mb-2 uppercase">Важная информация:</h3>
                    <ul class="list-disc list-inside space-y-1">
                        <li>Ставки действительны при наличии порожнего оборудования.</li>
                        <li>Нормативное время на погрузку/выгрузку: 24 часа.</li>
                        <li>Сверхнормативное пользование оплачивается отдельно.</li>
                    </ul>
                </div>
                <div class="text-right">
                    <h3 class="font-bold text-black mb-2 uppercase">Контакты менеджера:</h3>
                    <p class="font-bold text-base text-black mb-1">{{ user.first_name }} {{ user.last_name or '' }}</p>
                    <p>Email: {{ user.email_login or 'manager@logistrail.ru' }}</p>
                    <p class="mt-2 text-gray-400">ООО "Терминал"</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Автоматически открыть диалог печати при загрузке
        window.onload = function() {
            // Небольшая задержка для прогрузки стилей
            setTimeout(() => {
                window.print();
            }, 500);
        };
    </script>
</body>
</html>