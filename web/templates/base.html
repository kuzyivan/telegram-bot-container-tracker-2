<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- üî• –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTMX: –ñ–¥–µ–º 300–º—Å –ø–µ—Ä–µ–¥ –ø–æ–¥–º–µ–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —á—Ç–æ–±—ã —É—Å–ø–µ–ª–∞ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å—Å—è –∞–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è -->
    <meta name="htmx-config" content='{"defaultSwapDelay": 300}'>
    
    <title>{% block title %}Logistrail{% endblock %}</title>

    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Logistrail">
    <link rel="apple-touch-icon" href="/static/images/icon-192.png">

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mono: {
                            black: '#111111',
                            dark: '#2B2B2B',
                            gray: '#8E8E93',
                            border: '#E5E5EA',
                            bg: '#F5F5F7',
                            white: '#FFFFFF'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'monospace'],
                    },
                    boxShadow: {
                        'card': '0 1px 3px rgba(0,0,0,0.05), 0 5px 15px rgba(0,0,0,0.02)',
                        'up': '0 -4px 20px rgba(0,0,0,0.05)',
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #F5F5F7;
            color: #111111; 
            -webkit-tap-highlight-color: transparent;
        }
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom, 20px); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #D1D1D6; border-radius: 3px; }
        .flatpickr-calendar { border: none !important; box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important; border-radius: 16px !important; }
        .flatpickr-day.selected { background: #111111 !important; border-color: #111111 !important; }

        /* üî• HTMX ANIMATIONS (–ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏) */
        
        /* –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ) */
        main {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
            /* transform —É–±—Ä–∞–Ω –∏–∑ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        }

        /* 1. –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .htmx-swapping main {
            opacity: 0;
            transform: translateY(-15px);
        }

        /* 2. –ü–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .htmx-added main {
            opacity: 0;
            transform: translateY(15px);
        }

        /* 3. –§–∏–∫—Å–∞—Ü–∏—è */
        .htmx-settling main {
            opacity: 1;
            transform: translateY(0);
        }

        /* üî• –°–¢–ò–õ–ò –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –õ–û–ê–î–ï–†–ê */
        #global-loader {
            opacity: 0;
            pointer-events: none; /* –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –∫–ª–∏–∫–∞—Ç—å, –ø–æ–∫–∞ –Ω–µ–≤–∏–¥–∏–º */
            transition: opacity 0.2s ease-in-out;
        }
        
        /* –ö–ª–∞—Å—Å .htmx-request –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–∞–º–∏–º HTMX –∫ —ç–ª–µ–º–µ–Ω—Ç—É-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—É –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ */
        #global-loader.htmx-request {
            opacity: 1;
            pointer-events: auto; /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        }
    </style>
</head>

<!-- 
    üî• hx-boost="true": –í–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º SPA
    üî• hx-indicator="#global-loader": –ì–æ–≤–æ—Ä–∏—Ç HTMX –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—à –¥–∏–≤ –∫–∞–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –í–°–ï–• –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
-->
<body class="min-h-screen flex flex-col antialiased bg-mono-bg" hx-boost="true" hx-indicator="#global-loader">

    <header class="bg-mono-white sticky top-0 z-40 border-b border-mono-border">
        <div class="w-full px-4 sm:px-6 h-16 flex items-center justify-between">
            
            <div class="flex items-center gap-4 sm:gap-8">
                <a href="/" class="flex items-center gap-3 hover:opacity-70 transition">
                    <div class="bg-mono-black p-1.5 rounded-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-mono-black hidden sm:block">Logistrail</span>
                </a>

                <nav class="hidden md:flex items-center gap-2">
                    <a href="/" 
                       class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if request.url.path == '/' else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                        –ü–æ–∏—Å–∫
                    </a>
                    
                    <a href="/distance" 
                       class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if request.url.path == '/distance' else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                        –†–∞—Å—á—ë—Ç
                    </a>
                    
                    {% if user %}
                        <!-- –°–°–´–õ–ö–ò –î–õ–Ø –ê–î–ú–ò–ù–ê -->
                        {% if user.role == 'admin' %}
                            <a href="/admin/dashboard" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if request.url.path == '/admin/dashboard' else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –î–∞—à–±–æ—Ä–¥
                            </a>
                            <a href="/admin/schedule_planner" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if request.url.path == '/admin/schedule_planner' else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –ì—Ä–∞—Ñ–∏–∫
                            </a>
                            
                            <a href="/admin/companies" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if '/admin/companies' in request.url.path else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –ö–æ–º–ø–∞–Ω–∏–∏
                            </a>

                            <a href="/admin/calculator" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if '/admin/calculator' in request.url.path else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                            </a>
                        {% endif %}

                        <!-- üî• –°–°–´–õ–ö–ò –î–õ–Ø –ú–ï–ù–ï–î–ñ–ï–†–ê –¢–ï–†–ú–ò–ù–ê–õ–ê (–ò–õ–ò –ê–î–ú–ò–ù–ê) üî• -->
                        {% if user.role == 'admin' or (user.role == 'manager' and user.company_id == 3) or (user.role == 'owner' and user.company_id == 3) %}
                            <a href="/admin/costs" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if '/admin/costs' in request.url.path else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
                            </a>
                            
                            <!-- –ì–†–ê–§–ò–ö (–¢–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞, —É –∞–¥–º–∏–Ω–∞ –æ–Ω–∞ —É–∂–µ –µ—Å—Ç—å –≤—ã—à–µ) -->
                            {% if user.role != 'admin' %}
                            <a href="/admin/schedule_planner" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if '/admin/schedule_planner' in request.url.path else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –ì—Ä–∞—Ñ–∏–∫
                            </a>
                            {% endif %}
                        {% endif %}

                        <!-- –°–°–´–õ–ö–ê –î–õ–Ø –û–ë–´–ß–ù–´–• –ö–õ–ò–ï–ù–¢–û–í (–ù–ï –ê–î–ú–ò–ù –ò –ù–ï –ú–ï–ù–ï–î–ñ–ï–† –¢–ï–†–ú–ò–ù–ê–õ–ê) -->
                        {% if user.role != 'admin' and not (user.company_id == 3 and (user.role == 'manager' or user.role == 'owner')) %}
                            <a href="/client/dashboard" 
                               class="px-4 py-2 rounded-lg text-sm font-medium transition {{ 'bg-mono-black text-white shadow-sm' if request.url.path == '/client/dashboard' else 'text-mono-gray hover:text-mono-black hover:bg-mono-bg' }}">
                                –ú–æ–∏ –≥—Ä—É–∑—ã
                            </a>
                        {% endif %}
                    {% endif %}
                </nav>
            </div>

            <div class="flex items-center gap-4">
                {% if user %}
                    <!-- –°–°–´–õ–ö–ê –ù–ê –ü–†–û–§–ò–õ–¨ -->
                    <a href="/profile" class="flex items-center gap-3 pl-4 sm:border-l border-mono-border hover:opacity-70 transition group">
                        
                        <div class="text-right hidden sm:block">
                            <p class="text-xs font-bold text-mono-black group-hover:text-blue-600 transition">
                                {{ user.first_name }} {{ user.last_name or '' }}
                            </p>
                            <p class="text-[10px] text-mono-gray uppercase">{{ user.role }}</p>
                        </div>

                        <!-- –ê–í–ê–¢–ê–†–ö–ê -->
                        <div class="w-9 h-9 rounded-full bg-mono-bg flex items-center justify-center border border-mono-border overflow-hidden">
                            {% if user.avatar_url %}
                                <img src="{{ user.avatar_url }}" alt="Avatar" class="w-full h-full object-cover">
                            {% else %}
                                <!-- –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ -->
                                <span class="text-xs font-bold text-mono-gray">
                                    {{ user.first_name[0] if user.first_name else 'U' }}
                                </span>
                            {% endif %}
                        </div>
                    </a>

                    <!-- –ö–ù–û–ü–ö–ê –í–´–•–û–î–ê -->
                    <a href="/logout" class="ml-1 text-mono-gray hover:text-red-600 transition p-2 rounded-lg hover:bg-mono-bg" title="–í—ã–π—Ç–∏">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    </a>
                {% else %}
                    <a href="/login" class="text-sm font-bold text-mono-black hover:opacity-70 transition">–í–æ–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <main id="main-content" class="flex-grow w-full px-4 sm:px-6 lg:px-8 py-8 pb-24 md:pb-8">
        {% block content %}{% endblock %}
    </main>

    <!-- –ú–û–ë–ò–õ–¨–ù–û–ï –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-mono-border flex justify-around items-center pt-3 pb-2 z-[100] safe-area-pb shadow-up">
        
        <a href="/" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if request.url.path == '/' else 'text-mono-gray hover:text-mono-black' }} transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <span class="text-[10px] font-bold">–ü–æ–∏—Å–∫</span>
        </a>
        
        <a href="/distance" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if request.url.path == '/distance' else 'text-mono-gray hover:text-mono-black' }} transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 7m0 13V7"></path></svg>
            <span class="text-[10px] font-bold">–†–∞—Å—á—ë—Ç</span>
        </a>

        {% if user %}
            <!-- –ú–ï–ù–Æ –ê–î–ú–ò–ù–ê -->
            {% if user.role == 'admin' %}
                <a href="/admin/schedule_planner" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if '/admin/schedule_planner' in request.url.path else 'text-mono-gray hover:text-mono-black' }} transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span class="text-[10px] font-bold">–ì—Ä–∞—Ñ–∏–∫</span>
                </a>

                <a href="/admin/calculator" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if '/admin/calculator' in request.url.path else 'text-mono-gray hover:text-mono-black' }} transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    <span class="text-[10px] font-bold">–†–∞—Å—á–µ—Ç</span>
                </a>
            {% endif %}

            <!-- üî• –ú–ï–ù–Æ –ú–ï–ù–ï–î–ñ–ï–†–ê üî• -->
            {% if user.role == 'admin' or (user.role == 'manager' and user.company_id == 3) or (user.role == 'owner' and user.company_id == 3) %}
                <a href="/admin/costs" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if '/admin/costs' in request.url.path else 'text-mono-gray hover:text-mono-black' }} transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span class="text-[10px] font-bold">–°—Ç–∞–≤–∫–∞</span>
                </a>

                <!-- –ì–†–ê–§–ò–ö –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• (–µ—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω) -->
                {% if user.role != 'admin' %}
                <a href="/admin/schedule_planner" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if '/admin/schedule_planner' in request.url.path else 'text-mono-gray hover:text-mono-black' }} transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span class="text-[10px] font-bold">–ì—Ä–∞—Ñ–∏–∫</span>
                </a>
                {% endif %}
            {% endif %}

            <!-- –ö–ù–û–ü–ö–ê –ö–ê–ë–ò–ù–ï–¢–ê (–°–∫—Ä—ã—Ç–∞ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞) -->
            {% if user.role != 'admin' and not (user.company_id == 3 and (user.role == 'manager' or user.role == 'owner')) %}
                <a href="/client/dashboard" 
                   class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if 'dashboard' in request.url.path else 'text-mono-gray hover:text-mono-black' }} transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    <span class="text-[10px] font-bold">–ö–∞–±–∏–Ω–µ—Ç</span>
                </a>
            {% endif %}
        {% endif %}

        {% if not user %}
            <a href="/login" class="flex flex-col items-center gap-1 w-full {{ 'text-mono-black' if request.url.path == '/login' else 'text-mono-gray hover:text-mono-black' }} transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path></svg>
                <span class="text-[10px] font-bold">–í–æ–π—Ç–∏</span>
            </a>
        {% endif %}
    </nav>

    <!-- –ö–ù–û–ü–ö–ê "–ù–ê–í–ï–†–•" -->
    <button id="scrollToTopBtn" onclick="scrollToTop()" 
            class="fixed bottom-20 right-4 md:bottom-8 md:right-8 bg-mono-black text-white p-3 rounded-full shadow-lg transition-all duration-300 opacity-0 translate-y-10 invisible hover:bg-gray-800 active:scale-95 z-30 flex items-center justify-center">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
    </button>

    <!-- üî• –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ò–ù–î–ò–ö–ê–¢–û–† –ó–ê–ì–†–£–ó–ö–ò (–°–ü–ò–ù–ù–ï–†) -->
    <div id="global-loader" class="fixed inset-0 z-[100] flex items-center justify-center bg-white/50 backdrop-blur-sm transition-opacity duration-200">
        <div class="bg-white p-4 rounded-2xl shadow-xl border border-mono-border/50 transform scale-95 transition-transform duration-200">
            <svg class="animate-spin h-8 w-8 text-mono-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(reg => console.log('SW registered!', reg.scope))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }

        const scrollBtn = document.getElementById('scrollToTopBtn');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollBtn.classList.remove('opacity-0', 'translate-y-10', 'invisible');
            } else {
                scrollBtn.classList.add('opacity-0', 'translate-y-10', 'invisible');
            }
        });

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>