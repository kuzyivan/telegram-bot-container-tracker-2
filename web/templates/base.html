<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Logistrail{% endblock %}</title>

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    boxShadow: {
                        // Эффект вдавленного или выпуклого металла
                        'metal': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.5), 0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'metal-dark': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.3)',
                    },
                    colors: {
                        // Переопределяем стандартные цвета под твою палитру
                        mono: {
                            black: '#2B2B2B',  // Основной текст, кнопки
                            gray: '#6F767E',   // Вторичный текст, границы
                            light: '#F2F2F2',  // Фон блоков, ховеры
                            white: '#FFFFFF'   // Чистый белый
                        },
                        // Заменяем синий бренд на черный/серый для монохромности
                        blue: {
                            50: '#F2F2F2',     // Вместо голубого фона - светло-серый
                            100: '#E5E5E5',
                            500: '#6F767E',
                            600: '#2B2B2B',    // Основные кнопки теперь черные
                            700: '#1A1A1A',
                        },
                        slate: {
                            50: '#FAFAFA',     // Очень светлый фон
                            100: '#F2F2F2',    // Твой Light
                            200: '#E2E2E2',    // Границы
                            300: '#CCCCCC',
                            400: '#999999',
                            500: '#6F767E',    // Твой Gray
                            600: '#555555',
                            700: '#444444',
                            800: '#333333',
                            900: '#2B2B2B',    // Твой Black
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'monospace'], // Моноширинный для номеров контейнеров
                    }
                }
            }
        }
    </script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            /* background-color: #FFFFFF; /* Белый фон страницы */
            color: #2B2B2B; /* Темный текст */
        }
        
        /* Скроллбар в стиле минимализма */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #E2E2E2; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6F767E; }

        .htmx-indicator { display:none; }
        .htmx-request .htmx-indicator { display:inline; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Кастомизация Flatpickr под ч/б */
        .flatpickr-calendar { border: 1px solid #E2E2E2; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border-radius: 12px; }
        .flatpickr-day.selected { background: #2B2B2B !important; border-color: #2B2B2B !important; }
        .flatpickr-day:hover { background: #F2F2F2 !important; }

        /* Эффект анодированного алюминия */
        .bg-aluminum {
            /* 1. Базовый цвет (твой Light из палитры) */
            background-color: #F2F2F2;
            
            /* 2. Легкий градиент для имитации металлического блика */
            background-image: 
                linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(0,0,0,0.05) 100%),
                /* 3. SVG Шум для текстуры металла */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            
            /* Свойства фона */
            background-repeat: repeat; /* Шум повторяется */
            background-size: auto, 150px 150px; /* Размер зерна */
            background-blend-mode: normal; /* Смешивание */
        }
        
        .bg-aluminum-flat {
            background-color: #F2F2F2;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 150px 150px;
        }

        /* Для темной темы (Dark Aluminum / Gunmetal) */
        .dark .bg-aluminum {
            background-color: #1A1A1A; /* Темная база */
            background-image: 
                linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.2) 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
        }

        .dark .bg-aluminum-flat {
            background-color: #1A1A1A;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
        }
    </style>
</head>

<body class="bg-aluminum text-mono-black dark:text-mono-white min-h-screen flex flex-col antialiased">

    <header class="bg-aluminum-flat border-b border-mono-light/80 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            
            <div class="flex items-center gap-2">
                <a href="/" class="flex items-center gap-3 hover:opacity-70 transition duration-300">
                    <div class="bg-mono-black p-1.5 rounded-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-mono-black">Logistrail</span>
                </a>
            </div>

            <nav class="hidden md:flex gap-8 items-center">
                <a href="/track" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">Поиск</a>
                <a href="/distance" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">Расчёт</a>

                {% if user %}
                    {% if user.role == 'admin' %}
                        <a href="/admin/dashboard" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">Дашборд</a>
                        <a href="/admin/schedule_planner" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">График</a>
                        <a href="/admin/companies" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">Компании</a>
                    {% else %}
                        <a href="/client/dashboard" class="text-sm font-medium text-mono-gray hover:text-mono-black transition">Мои грузы</a>
                    {% endif %}

                    <div class="h-4 w-px bg-mono-light mx-2"></div>
                    
                    <div class="flex items-center gap-3">
                        <span class="text-xs font-bold text-mono-black uppercase tracking-wider bg-mono-light px-2 py-1 rounded">{{ user.role }}.{{ user.first_name }}</span>
                        <a href="/logout" class="text-sm font-medium text-red-600 hover:text-red-800 transition">Выход</a>
                    </div>
                {% else %}
                    <a href="/login" class="text-sm font-bold text-mono-black hover:opacity-70 transition">Войти</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-aluminum-flat border-t border-mono-light/80 mt-auto">
        <div class="max-w-7xl mx-auto px-4 py-8 flex justify-between items-center text-xs text-mono-gray">
            <p>&copy; 2025 Logistrail Tracker.</p>
            <p class="hidden sm:block opacity-60">Monochrome Edition v2.0</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>
