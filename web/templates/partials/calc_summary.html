<div class="bg-white p-6 rounded-2xl shadow-lg border border-mono-border animate-fade-in relative overflow-hidden">
    
    <div class="absolute top-0 left-0 w-full h-1 bg-mono-black"></div>

    <h3 class="text-base font-bold text-mono-black mb-5 flex justify-between items-center">
        Итоги расчета
        {% if tariff_found %}
            <span class="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded font-bold uppercase tracking-wider">Тариф найден</span>
        {% else %}
            <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded font-bold uppercase tracking-wider">Нет тарифа</span>
        {% endif %}
    </h3>
    
    <div class="space-y-3 text-sm">
        <div class="flex justify-between items-center group">
            <span class="text-mono-gray border-b border-dashed border-gray-200 group-hover:border-mono-gray transition cursor-help" title="Базовая ставка ЖД из базы данных">Тариф ЖД (База):</span>
            <span class="font-mono font-medium text-mono-black">{{ "{:,.0f}".format(base_rate).replace(',', ' ') }}</span>
        </div>
        
        {% if gondola_coeff != 1.0 %}
        <div class="flex justify-between items-center text-blue-600 bg-blue-50 px-2 py-1 -mx-2 rounded">
            <span class="text-xs font-bold">Полувагон (x{{ gondola_coeff }}):</span>
            <span class="font-mono font-bold text-xs">+{{ "{:,.0f}".format(adjusted_base_rate - base_rate).replace(',', ' ') }}</span>
        </div>
        {% endif %}

        {% if extra_expenses > 0 %}
        <div class="flex justify-between items-center text-mono-dark font-medium bg-mono-bg px-2 py-1 -mx-2 rounded">
            <span class="text-xs">Доп. расходы (Сумма):</span>
            <span class="font-mono">{{ "{:,.0f}".format(extra_expenses).replace(',', ' ') }}</span>
        </div>
        {% endif %}
        
        <div class="flex justify-between items-center pt-3 mt-1 border-t border-mono-border">
            <span class="font-bold text-mono-black">Себестоимость:</span>
            <span class="font-mono font-bold text-mono-black">{{ "{:,.0f}".format(total_cost).replace(',', ' ') }}</span>
        </div>

        <div class="flex justify-between items-center pt-2">
            <span class="text-mono-gray">Цена (без НДС):</span>
            <span class="font-mono font-medium text-mono-black">{{ "{:,.0f}".format(sales_price_netto).replace(',', ' ') }}</span>
        </div>
        
        <div class="flex justify-between items-center text-xs text-mono-gray">
            <span>НДС 20%:</span>
            <span class="font-mono">{{ "{:,.0f}".format(vat_amount).replace(',', ' ') }}</span>
        </div>
    </div>

    <div class="mt-6 pt-5 border-t-2 border-mono-black">
        <div class="text-center">
            <span class="block text-[10px] font-bold text-mono-gray uppercase tracking-widest mb-1">Итого клиенту</span>
            <span class="block text-4xl font-extrabold text-mono-black tracking-tighter">
                {{ "{:,.0f}".format(total_price_with_vat).replace(',', ' ') }}
                <span class="text-lg font-normal text-mono-gray ml-1">₽</span>
            </span>
        </div>
    </div>

    {% if not tariff_found %}
    <div class="mt-4 p-3 bg-red-50 text-red-600 text-xs rounded-lg text-center font-medium border border-red-100 animate-pulse">
        ⚠️ Тариф для этого направления не найден в базе. Используется 0.
    </div>
    {% endif %}
</div>