<div class="relative h-64 w-full animate-fade-in">
    <canvas id="clientsChart"></canvas>
</div>

<script>
    // Если график уже существует (при обновлении), уничтожаем его, чтобы нарисовать новый
    // Проверяем, определена ли переменная и существует ли экземпляр
    if (typeof clientsChartInstance !== 'undefined' && clientsChartInstance) {
        clientsChartInstance.destroy();
    }

    var ctx = document.getElementById('clientsChart').getContext('2d');
    const isDarkMode = document.documentElement.classList.contains('dark');
    
    // Создаем глобальную переменную (через window), чтобы иметь к ней доступ при следующем обновлении
    window.clientsChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ chart_clients_labels|safe }},
            datasets: [{
                label: 'Контейнеров',
                data: {{ chart_clients_values|safe }},
                backgroundColor: [
                    '#3b82f6', '#8b5cf6', '#ec4899', '#f43f5e', 
                    '#f97316', '#eab308', '#10b981'
                ],
                borderRadius: 6,
                barThickness: 40,
                maxBarThickness: 60
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { 
                legend: { display: false },
                tooltip: {
                    backgroundColor: isDarkMode ? 'rgb(30 41 59 / 0.9)' : 'rgb(248 250 252 / 0.9)',
                    titleColor: isDarkMode ? '#cbd5e1' : '#1e293b',
                    bodyColor: isDarkMode ? '#cbd5e1' : '#1e293b',
                    padding: 10,
                    cornerRadius: 8,
                    borderColor: isDarkMode ? '#334155' : '#e2e8f0',
                    borderWidth: 1
                }
            },
            scales: { 
                y: { 
                    beginAtZero: true,
                    grid: { 
                        borderDash: [4, 4], 
                        color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : '#f1f5f9'
                    },
                    ticks: { 
                        precision: 0,
                        color: isDarkMode ? '#94a3b8' : '#64748b'
                    }
                },
                x: {
                    grid: { display: false },
                    ticks: {
                        color: isDarkMode ? '#94a3b8' : '#64748b'
                    }
                }
            },
            animation: {
                duration: 500 // Немного ускорим анимацию при обновлении
            }
        }
    });
</script>