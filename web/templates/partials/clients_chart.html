<div class="relative h-full w-full animate-fade-in">
    <canvas id="clientsChart"></canvas>
</div>

<script>
    if (typeof clientsChartInstance !== 'undefined' && clientsChartInstance) {
        clientsChartInstance.destroy();
    }

    var ctx = document.getElementById('clientsChart').getContext('2d');
    
    // Создаем градиентную палитру серого
    const colors = [
        '#111111', // Черный
        '#333333', // Темно-серый
        '#555555',
        '#777777',
        '#999999',
        '#BBBBBB',
        '#DDDDDD'  // Светло-серый
    ];

    window.clientsChartInstance = new Chart(ctx, {
        type: 'doughnut', // Круговая диаграмма как на скрине
        data: {
            labels: {{ chart_clients_labels|safe }},
            datasets: [{
                data: {{ chart_clients_values|safe }},
                backgroundColor: colors,
                borderWidth: 0, // Убираем границы сегментов для чистоты
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%', // Делаем "пончик" тоньше
            plugins: { 
                legend: { 
                    position: 'right',
                    labels: { 
                        usePointStyle: true,
                        pointStyle: 'circle',
                        font: { family: "'Inter', sans-serif", size: 12 },
                        color: '#111111'
                    }
                },
                tooltip: {
                    backgroundColor: '#111111',
                    titleColor: '#FFFFFF',
                    bodyColor: '#FFFFFF',
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false
                }
            },
            layout: { padding: 10 }
        }
    });
    
    // Рисуем текст в центре (опционально, если нужно показать общий процент/число)
    Chart.register({
        id: 'centerText',
        beforeDraw: function(chart) {
            var width = chart.width, height = chart.height, ctx = chart.ctx;
            ctx.restore();
            var fontSize = (height / 114).toFixed(2);
            ctx.font = "bold " + fontSize + "em Inter";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#111111";
            
            var text = "{{ total_sent }}", // Общее число
                textX = Math.round((width - ctx.measureText(text).width) / 2) - 40, // Смещение из-за легенды справа
                textY = height / 2;
            
            // Простая центровка, если легенда справа
            if (chart.config.options.plugins.legend.position === 'right') {
                 // ручная подгонка не идеальна, но работает для демо
            } else {
                 ctx.fillText(text, textX, textY);
            }
            ctx.save();
        }
    });
</script>
