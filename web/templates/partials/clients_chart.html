<div class="relative h-64 w-full animate-fade-in">
    <canvas id="clientsChart"></canvas>
</div>

<script>
    // Если график уже существует (при обновлении), уничтожаем его, чтобы нарисовать новый
    // Проверяем, определена ли переменная и существует ли экземпляр
    if (typeof clientsChartInstance !== 'undefined' && clientsChartInstance) {
        clientsChartInstance.destroy();
    }

    var ctx = document.getElementById('clientsChart').getContext('2d');
    
    // Создаем глобальную переменную (через window), чтобы иметь к ней доступ при следующем обновлении
    window.clientsChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ chart_clients_labels|safe }},
            datasets: [{
                label: 'Контейнеров',
                data: {{ chart_clients_values|safe }},
                backgroundColor: [
                    '#2B2B2B',
                    '#4F4F4F',
                    '#6F767E',
                    '#9CA3AF',
                    '#D1D5DB',
                    '#E5E7EB'
                ],
                borderRadius: 6,
                barThickness: 40,
                maxBarThickness: 60
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { 
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgb(255 255 255 / 0.9)',
                    titleColor: '#2B2B2B',
                    bodyColor: '#2B2B2B',
                    padding: 10,
                    cornerRadius: 8,
                    borderColor: '#E2E2E2',
                    borderWidth: 1
                }
            },
            scales: { 
                y: { 
                    beginAtZero: true,
                    grid: { 
                        borderDash: [4, 4], 
                        color: '#F2F2F2'
                    },
                    ticks: { 
                        precision: 0,
                        color: '#6F767E'
                    }
                },
                x: {
                    grid: { display: false },
                    ticks: {
                        color: '#6F767E'
                    }
                }
            },
            animation: {
                duration: 500 // Немного ускорим анимацию при обновлении
            }
        }
    });
</script>