{% extends "base.html" %}

{% block title %}–†–µ–µ—Å—Ç—Ä –ø–æ–µ–∑–¥–æ–≤ ‚Äî Logistrail{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8 animate-fade-in">
    
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-mono-black tracking-tight">–†–µ–µ—Å—Ç—Ä –ø–æ–µ–∑–¥–æ–≤</h1>
            <p class="text-sm text-mono-gray">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏</p>
        </div>
        
        <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–°–µ—Ä–≤–µ—Ä–Ω—ã–π) -->
        <form action="/admin/trains" method="GET" class="relative">
            <input type="text" name="q" value="{{ q }}" placeholder="–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫..." 
                   class="pl-10 pr-4 py-2 bg-white border border-mono-border rounded-xl text-sm outline-none focus:ring-2 focus:ring-mono-black transition w-64 shadow-sm">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </form>
    </div>

    <div class="bg-white rounded-2xl shadow-card border border-transparent overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left border-collapse" id="trainsTable">
                <thead class="bg-mono-bg text-mono-gray text-[10px] uppercase font-bold tracking-wider">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
                    <tr>
                        <th class="px-6 py-4">–ù–æ–º–µ—Ä (–¢–µ—Ä–º–∏–Ω–∞–ª)</th>
                        <th class="px-6 py-4">–†–ñ–î –ù–æ–º–µ—Ä</th>
                        <th class="px-6 py-4">–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞</th>
                        <th class="px-6 py-4">–î–∞—Ç–∞ –ø—Ä–∏–±. (–ü–ª–∞–Ω)</th>
                        <th class="px-6 py-4">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                        <th class="px-6 py-4 text-center">–ö–æ–Ω—Ç.</th>
                        <th class="px-6 py-4 text-right">–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                    
                    <!-- üî• –°—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (Inputs) -->
                    <tr class="bg-white border-b border-mono-border">
                        <th class="px-6 py-2">
                            <input type="text" id="filterTerminal" onkeyup="filterTable()" placeholder="–ü–æ–∏—Å–∫..." 
                                   class="w-full px-2 py-1 text-xs border border-mono-border rounded focus:outline-none focus:border-mono-black transition">
                        </th>
                        <th class="px-6 py-2">
                            <input type="text" id="filterRzd" onkeyup="filterTable()" placeholder="–ü–æ–∏—Å–∫..." 
                                   class="w-full px-2 py-1 text-xs border border-mono-border rounded focus:outline-none focus:border-mono-black transition">
                        </th>
                        <th class="px-6 py-2">
                            <input type="text" id="filterDepDate" onkeyup="filterTable()" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" 
                                   class="w-full px-2 py-1 text-xs border border-mono-border rounded focus:outline-none focus:border-mono-black transition">
                        </th>
                        <th class="px-6 py-2">
                            <input type="text" id="filterArrDate" onkeyup="filterTable()" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" 
                                   class="w-full px-2 py-1 text-xs border border-mono-border rounded focus:outline-none focus:border-mono-black transition">
                        </th>
                        <th class="px-6 py-2">
                            <input type="text" id="filterDest" onkeyup="filterTable()" placeholder="–ü–æ–∏—Å–∫..." 
                                   class="w-full px-2 py-1 text-xs border border-mono-border rounded focus:outline-none focus:border-mono-black transition">
                        </th>
                        <th colspan="2"></th> <!-- –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ –∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    </tr>
                </thead>
                
                <tbody class="divide-y divide-mono-border">
                    {% for train in trains %}
                    <!-- –î–æ–±–∞–≤–ª—è–µ–º data-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
                    <tr class="hover:bg-mono-bg transition group cursor-pointer train-row" 
                        onclick="window.location='/admin/trains/{{ train.id }}'"
                        data-terminal="{{ train.terminal_train_number }}"
                        data-rzd="{{ train.rzd_train_number or '' }}"
                        data-dep="{{ train.departure_date.strftime('%d.%m.%Y') if train.departure_date else '' }}"
                        data-arr="{{ train.arrival_date.strftime('%d.%m.%Y') if train.arrival_date else '' }}"
                        data-dest="{{ train.destination_station or '' }}">
                        
                        <td class="px-6 py-4">
                            <span class="font-mono font-bold text-mono-black text-sm">{{ train.terminal_train_number }}</span>
                        </td>
                        <td class="px-6 py-4 text-mono-gray font-mono text-xs">
                            {{ train.rzd_train_number or '‚Äî' }}
                        </td>
                        <td class="px-6 py-4">
                            {% if train.departure_date %}
                                <span class="font-medium text-mono-black">{{ train.departure_date.strftime('%d.%m.%Y') }}</span>
                            {% else %}
                                <span class="text-gray-300 text-xs">‚Äî</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4">
                            {% if train.arrival_date %}
                                <span class="font-medium text-green-700 bg-green-50 px-2 py-1 rounded text-xs">{{ train.arrival_date.strftime('%d.%m.%Y') }}</span>
                            {% else %}
                                <span class="text-gray-300 text-xs font-mono">–í –ø—É—Ç–∏</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 font-medium text-mono-black">
                            {{ train.destination_station or '‚Äî' }}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="bg-mono-bg text-mono-black px-2 py-1 rounded text-xs font-bold">{{ train.container_count or 0 }}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <svg class="w-5 h-5 text-gray-400 group-hover:text-mono-black transition inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-mono-gray">–ü–æ–µ–∑–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function filterTable() {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∏–Ω–ø—É—Ç–æ–≤ (–≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –¥–ª—è –Ω–µ—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É)
        const termVal = document.getElementById('filterTerminal').value.toLowerCase();
        const rzdVal = document.getElementById('filterRzd').value.toLowerCase();
        const depVal = document.getElementById('filterDepDate').value.toLowerCase();
        const arrVal = document.getElementById('filterArrDate').value.toLowerCase();
        const destVal = document.getElementById('filterDest').value.toLowerCase();

        const rows = document.querySelectorAll('.train-row');

        rows.forEach(row => {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤
            const t = row.getAttribute('data-terminal').toLowerCase();
            const r = row.getAttribute('data-rzd').toLowerCase();
            const d = row.getAttribute('data-dep').toLowerCase();
            const a = row.getAttribute('data-arr').toLowerCase();
            const dst = row.getAttribute('data-dest').toLowerCase();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤—Å–µ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è)
            const matchTerm = t.includes(termVal);
            const matchRzd = r.includes(rzdVal);
            const matchDep = d.includes(depVal);
            const matchArr = a.includes(arrVal);
            const matchDest = dst.includes(destVal);

            if (matchTerm && matchRzd && matchDep && matchArr && matchDest) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}